{% extends "base.html" %}

{% block title %}روابط المواصلات - {{ super() }}{% endblock %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">روابط المواصلات</h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        <a href="{{ url_for('add_connection') }}" class="btn btn-primary">
            <i class="bi bi-plus-lg"></i> إضافة ربط جديد
        </a>
    </div>
</div>

{% if connections %}
<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead class="table-dark">
            <tr>
                <th>من الخط</th>
                <th>إلى الخط</th>
                <th>نقطة التحويل</th>
                <th>وقت المشي</th>
                <th>ملاحظات</th>
                <th>تاريخ الإضافة</th>
                <th>الإجراءات</th>
            </tr>
        </thead>
        <tbody>
            {% for connection in connections %}
            <tr>
                <td>
                    <strong>{{ connection.from_route.name }}</strong>
                    <br><small class="text-muted">{{ connection.from_route.start_area }} → {{ connection.from_route.end_area }}</small>
                </td>
                <td>
                    <strong>{{ connection.to_route.name }}</strong>
                    <br><small class="text-muted">{{ connection.to_route.start_area }} → {{ connection.to_route.end_area }}</small>
                </td>
                <td>
                    <span class="badge bg-info">{{ connection.connection_point }}</span>
                </td>
                <td>
                    <span class="badge bg-warning text-dark">{{ connection.walking_time }} دقيقة</span>
                </td>
                <td>
                    {% if connection.connection_notes %}
                    <small>{{ connection.connection_notes }}</small>
                    {% else %}
                    <span class="text-muted">لا توجد ملاحظات</span>
                    {% endif %}
                </td>
                <td>
                    <small class="text-muted">{{ connection.created_at.strftime('%Y-%m-%d') }}</small>
                </td>
                <td>
                    <div class="btn-group" role="group">
                        <a href="{{ url_for('edit_connection', connection_id=connection.id) }}" 
                           class="btn btn-sm btn-outline-primary">
                            <i class="bi bi-pencil"></i>
                        </a>
                        <button type="button" class="btn btn-sm btn-outline-danger" 
                                onclick="confirmDelete({{ connection.id }})">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- نماذج حذف مخفية -->
{% for connection in connections %}
<form id="deleteForm{{ connection.id }}" method="POST" action="{{ url_for('delete_connection', connection_id=connection.id) }}" style="display: none;">
</form>
{% endfor %}

{% else %}
<div class="text-center py-5">
    <i class="bi bi-arrow-left-right display-1 text-muted"></i>
    <h3 class="mt-3">لا توجد روابط بين المواصلات</h3>
    <p class="text-muted">ابدأ بإضافة روابط بين المواصلات لتوفير خيارات أكثر للمستخدمين</p>
    <a href="{{ url_for('add_connection') }}" class="btn btn-primary">
        <i class="bi bi-plus-lg"></i> إضافة أول ربط
    </a>
</div>
{% endif %}

<div class="mt-4">
    <div class="alert alert-info">
        <i class="bi bi-info-circle"></i>
        <strong>حول روابط المواصلات:</strong>
        تساعد روابط المواصلات المستخدمين في الوصول للأماكن التي تحتاج أكثر من مواصلة واحدة. 
        يمكن للبوت أن يقترح مسارات تتضمن التحويل من مواصلة لأخرى.
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function confirmDelete(connectionId) {
    if (confirm('هل أنت متأكد من حذف هذا الربط؟ هذا الإجراء لا يمكن التراجع عنه!')) {
        document.getElementById('deleteForm' + connectionId).submit();
    }
}
</script>
{% endblock %}